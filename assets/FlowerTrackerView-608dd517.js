import{e as U,P as $,b as j,W as q,f as Q,V as Y,H as J,D as K,C as O,M as V,g as H,h as Z,d as F,i as tt,j as et,k as nt,l as ot,I as it,m as st}from"./three.module-5f6cbc95.js";import{d as at}from"./shader-renderer-d77d85b0.js";import{d as N,r as rt,_ as ct,o as X,c as lt,a as dt,b as ft,u as k}from"./index-10f08df8.js";import{u as wt}from"./options-b1605e21.js";var W=function(){var f=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(l){l.preventDefault(),a(++f%t.children.length)},!1);function n(l){return t.appendChild(l.dom),l}function a(l){for(var w=0;w<t.children.length;w++)t.children[w].style.display=w===l?"block":"none";f=l}var d=(performance||Date).now(),c=d,e=0,y=n(new W.Panel("FPS","#0ff","#002")),p=n(new W.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=n(new W.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:t,addPanel:n,showPanel:a,begin:function(){d=(performance||Date).now()},end:function(){e++;var l=(performance||Date).now();if(p.update(l-d,200),l>=c+1e3&&(y.update(e*1e3/(l-c),100),c=l,e=0,h)){var w=performance.memory;h.update(w.usedJSHeapSize/1048576,w.jsHeapSizeLimit/1048576)}return l},update:function(){d=this.end()},domElement:t,setMode:a}};W.Panel=function(f,t,n){var a=1/0,d=0,c=Math.round,e=c(window.devicePixelRatio||1),y=80*e,p=48*e,h=3*e,l=2*e,w=3*e,b=15*e,M=74*e,R=30*e,v=document.createElement("canvas");v.width=y,v.height=p,v.style.cssText="width:80px;height:48px";var r=v.getContext("2d");return r.font="bold "+9*e+"px Helvetica,Arial,sans-serif",r.textBaseline="top",r.fillStyle=n,r.fillRect(0,0,y,p),r.fillStyle=t,r.fillText(f,h,l),r.fillRect(w,b,M,R),r.fillStyle=n,r.globalAlpha=.9,r.fillRect(w,b,M,R),{dom:v,update:function(z,i){a=Math.min(a,z),d=Math.max(d,z),r.fillStyle=n,r.globalAlpha=1,r.fillRect(0,0,y,b),r.fillStyle=t,r.fillText(c(z)+" "+f+" ("+c(a)+"-"+c(d)+")",h,l),r.drawImage(v,w+e,b,M-e,R,w,b,M-e,R),r.fillRect(w+M-e,b,e,R),r.fillStyle=n,r.globalAlpha=.9,r.fillRect(w+M-e,b,e,c((1-z/i)*R))}}};const ht=W;let s;class ut{constructor(t,n,a,d,c,e){this.body_=t,this.transform_=n,this.motionState_=a,this.shape_=d,this.inertia_=c,this.info_=e}setRestitution(t){var n;(n=this.body_)==null||n.setRestitution(t)}setFriction(t){var n;(n=this.body_)==null||n.setFriction(t)}setRollingFriction(t){var n;(n=this.body_)==null||n.setRollingFriction(t)}}class pt extends ut{constructor(t,n,a){const d=new s.btTransform;d.setIdentity(),d.setOrigin(new s.btVector3(n.x,n.y,n.z)),d.setRotation(new s.btQuaternion(0,0,0,1));const c=new s.btDefaultMotionState(d),e=new s.btSphereShape(a);e.setMargin(.05);const y=new s.btVector3(0,0,0);t>0&&e.calculateLocalInertia(t,y);const p=new s.btRigidBodyConstructionInfo(t,c,e,y),h=new s.btRigidBody(p);super(h,d,c,e,y,p)}}async function mt(){if(!("Ammo"in window)){console.error("AmmoPhysics: Couldn't find Ammo.js");return}typeof Ammo=="function"?s=await Ammo():s=Ammo;const f=60,t=new s.btDefaultCollisionConfiguration,n=new s.btCollisionDispatcher(t),a=new s.btDbvtBroadphase,d=new s.btSequentialImpulseConstraintSolver,c=new s.btDiscreteDynamicsWorld(n,a,d,t);c.setGravity(new s.btVector3(0,-9.8,0));const e=new s.btTransform;function y(i){const o=i.parameters;if(i.type==="BoxGeometry"){const m=o.width!==void 0?o.width/2:.5,g=o.height!==void 0?o.height/2:.5,u=o.depth!==void 0?o.depth/2:.5,S=new s.btBoxShape(new s.btVector3(m,g,u));return S.setMargin(.05),S}else if(i.type==="SphereGeometry"||i.type==="IcosahedronGeometry"){const m=o.radius!==void 0?o.radius:1,g=new s.btSphereShape(m);return g.setMargin(.05),g}return null}const p=[],h=new WeakMap;function l(i,o,m=0){o!==null&&(i.isInstancedMesh?R(i,m,o):i.isMesh&&M(i,m,o))}function w(i,o,m=0){l(i,o.shape_,m)}function b(i,o=0){const m=y(i.geometry);l(i,m,o)}function M(i,o,m){const g=i.position,u=i.quaternion,S=new s.btTransform;S.setIdentity(),S.setOrigin(new s.btVector3(g.x,g.y,g.z)),S.setRotation(new s.btQuaternion(u.x,u.y,u.z,u.w));const T=new s.btDefaultMotionState(S),x=new s.btVector3(0,0,0);m.calculateLocalInertia(o,x);const A=new s.btRigidBodyConstructionInfo(o,T,m,x),B=new s.btRigidBody(A);c.addRigidBody(B),o>0&&(p.push(i),h.set(i,B))}function R(i,o,m){const g=i.instanceMatrix.array,u=[];for(let S=0;S<i.count;S++){const T=S*16,x=new s.btTransform;x.setFromOpenGLMatrix(g.slice(T,T+16));const A=new s.btDefaultMotionState(x),B=new s.btVector3(0,0,0);m.calculateLocalInertia(o,B);const E=new s.btRigidBodyConstructionInfo(o,A,m,B),D=new s.btRigidBody(E);c.addRigidBody(D),u.push(D)}o>0&&(p.push(i),h.set(i,u))}function v(i,o,m=0){if(i.isInstancedMesh){const u=h.get(i)[m];u.setAngularVelocity(new s.btVector3(0,0,0)),u.setLinearVelocity(new s.btVector3(0,0,0)),e.setIdentity(),e.setOrigin(new s.btVector3(o.x,o.y,o.z)),u.setWorldTransform(e)}else if(i.isMesh){const g=h.get(i);g.setAngularVelocity(new s.btVector3(0,0,0)),g.setLinearVelocity(new s.btVector3(0,0,0)),e.setIdentity(),e.setOrigin(new s.btVector3(o.x,o.y,o.z)),g.setWorldTransform(e)}}let r=0;function z(){const i=performance.now();if(r>0){const o=(i-r)/1e3;c.stepSimulation(o,10);for(let m=0,g=p.length;m<g;m++){const u=p[m];if(u.isInstancedMesh){const S=u.instanceMatrix.array,T=h.get(u);for(let x=0;x<T.length;x++){T[x].getMotionState().getWorldTransform(e);const E=e.getOrigin(),D=e.getRotation();yt(E,D,S,x*16)}u.instanceMatrix.needsUpdate=!0,u.computeBoundingSphere()}else if(u.isMesh){h.get(u).getMotionState().getWorldTransform(e);const x=e.getOrigin(),A=e.getRotation();u.position.set(x.x(),x.y(),x.z()),u.quaternion.set(A.x(),A.y(),A.z(),A.w())}}}r=i}return setInterval(z,1e3/f),{addMesh:b,addMeshAndBody:w,setMeshPosition:v}}function yt(f,t,n,a){const d=t.x(),c=t.y(),e=t.z(),y=t.w(),p=d+d,h=c+c,l=e+e,w=d*p,b=d*h,M=d*l,R=c*h,v=c*l,r=e*l,z=y*p,i=y*h,o=y*l;n[a+0]=1-(R+r),n[a+1]=b+o,n[a+2]=M-i,n[a+3]=0,n[a+4]=b-o,n[a+5]=1-(w+r),n[a+6]=v+z,n[a+7]=0,n[a+8]=M+i,n[a+9]=v-z,n[a+10]=1-(w+R),n[a+11]=0,n[a+12]=f.x(),n[a+13]=f.y(),n[a+14]=f.z(),n[a+15]=1}new U;let C=new $,_=new j,L=new q,G=new ht,P,I;new Q;const bt=N({data(){return{pointer:new Y(-100,-100),inTransition:!1,transitionIteration:0,transitionLength:100,stopAnimate:!1}},setup(){return{canvasRef:rt(null)}},props:{backgroundColor:String},methods:{onWindowResize(){const f=this.$refs.canvasRef;let t=f.parentElement;t&&(f.width===t.clientWidth||f.height===t.clientHeight||(C.aspect=t.clientWidth/t.clientHeight,L.setSize(t.clientWidth,t.clientHeight),C.updateProjectionMatrix()))},animate(f){this.stopAnimate||(this.onWindowResize(),requestAnimationFrame(this.animate),this.render(f),G==null||G.update())},render(f){L.render(_,C)}},async mounted(){P=await mt(),_=new j;const f=this.$refs.canvasRef,t=f.parentElement,n=t?t.clientWidth:window.innerWidth,a=t?t.clientHeight:window.innerHeight;L=new q({antialias:!0,canvas:f}),L.setPixelRatio(window.devicePixelRatio),L.setSize(n,a),L.shadowMap.enabled=!0,C=new $(70,n/a,.1,1e3),C.position.set(2,1.5,2),C.lookAt(0,0,0);const d=new J;_.add(d);const c=new K(16777215,3);c.position.set(5,5,5),c.castShadow=!0,c.shadow.camera.zoom=2,_.add(c),_.background=new O(6710886);const e=new V(new H(10,5,10),new Z({color:4473924}));e.position.y=-2.5,e.receiveShadow=!0,_.add(e),P.addMesh(e);const y=new V(new H(10,5,10),new F({color:6710886}));y.position.y=-2.5,_.add(y);const p=new F({color:16711680});p.opacity=0,p.transparent=!0;let h=new V(new H(1,15,4),p);h.position.y=0,h.position.z=0,h.position.x=2.5,_.add(h),P.addMesh(h);let l=new V(new H(4,15,1),p);l.position.y=0,l.position.z=-2.5,l.position.x=0,_.add(l),P.addMesh(l);let w=new V(new H(4,15,1),p);w.position.y=0,w.position.z=2.5,w.position.x=0,_.add(w),P.addMesh(w);let b=new V(new H(1,15,4),p);b.position.y=0,b.position.z=0,b.position.x=-2.5,_.add(b),P.addMesh(b),new tt;const M=new et,R=new O;new nt().load("/models/suzanne_buffergeometry.json",r=>{r.computeVertexNormals(),r.scale(.07,.07,.07);const z=new ot;I=new it(r,z,500),I.instanceMatrix.setUsage(st),_.add(I),I.castShadow=!0,I.receiveShadow=!0;for(let o=0;o<I.count;o++)M.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),I.setMatrixAt(o,M),I.setColorAt(o,R.setHex(16777215*Math.random()));const i=new pt(1,I.position,.075);P.addMeshAndBody(I,i,1)}),window.addEventListener("resize",this.onWindowResize),t==null||t.addEventListener("resize",this.onWindowResize),this.onWindowResize(),this.animate(0)},unmounted(){this.stopAnimate=!0,at(_)}}),gt={class:"flex-grow-1 p-0 m-0 mw-100 mh-100 overflow-hidden"},Mt={ref:"canvasRef"};function St(f,t,n,a,d,c){return X(),lt("div",gt,[dt("canvas",Mt,null,512)])}const xt=ct(bt,[["render",St]]),It=N({__name:"FlowerTrackerView",setup(f){const t=wt();return(n,a)=>(X(),ft(xt,{"lines-count":k(t).numOfLines,"points-count":k(t).numOfPoints,"background-color":k(t).backgroundColor,"line-color":k(t).lineColor},null,8,["lines-count","points-count","background-color","line-color"]))}});export{It as default};
