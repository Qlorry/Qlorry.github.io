import{e as X,P as $,b as U,W as j,f as Q,V as Y,H as J,D as K,C as O,M as V,g as C,h as Z,d as F,i as tt,j as et,k as nt,l as ot,I as it,m as st}from"./three.module-5f6cbc95.js";import{d as at}from"./shader-renderer-c332ea35.js";import{d as q,r as rt,_ as ct,o as N,c as lt,a as dt,b as ft,u as k}from"./index-34201417.js";import{u as ut}from"./options-1d295164.js";var L=function(){var d=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(l){l.preventDefault(),a(++d%n.children.length)},!1);function e(l){return n.appendChild(l.dom),l}function a(l){for(var u=0;u<n.children.length;u++)n.children[u].style.display=u===l?"block":"none";d=l}var f=(performance||Date).now(),c=f,t=0,b=e(new L.Panel("FPS","#0ff","#002")),p=e(new L.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var w=e(new L.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:n,addPanel:e,showPanel:a,begin:function(){f=(performance||Date).now()},end:function(){t++;var l=(performance||Date).now();if(p.update(l-f,200),l>=c+1e3&&(b.update(t*1e3/(l-c),100),c=l,t=0,w)){var u=performance.memory;w.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return l},update:function(){f=this.end()},domElement:n,setMode:a}};L.Panel=function(d,n,e){var a=1/0,f=0,c=Math.round,t=c(window.devicePixelRatio||1),b=80*t,p=48*t,w=3*t,l=2*t,u=3*t,y=15*t,M=74*t,_=30*t,R=document.createElement("canvas");R.width=b,R.height=p,R.style.cssText="width:80px;height:48px";var r=R.getContext("2d");return r.font="bold "+9*t+"px Helvetica,Arial,sans-serif",r.textBaseline="top",r.fillStyle=e,r.fillRect(0,0,b,p),r.fillStyle=n,r.fillText(d,w,l),r.fillRect(u,y,M,_),r.fillStyle=e,r.globalAlpha=.9,r.fillRect(u,y,M,_),{dom:R,update:function(z,i){a=Math.min(a,z),f=Math.max(f,z),r.fillStyle=e,r.globalAlpha=1,r.fillRect(0,0,b,y),r.fillStyle=n,r.fillText(c(z)+" "+d+" ("+c(a)+"-"+c(f)+")",w,l),r.drawImage(R,u+t,y,M-t,_,u,y,M-t,_),r.fillRect(u+M-t,y,t,_),r.fillStyle=e,r.globalAlpha=.9,r.fillRect(u+M-t,y,t,c((1-z/i)*_))}}};const wt=L;let s;class ht{constructor(n,e,a,f,c,t){this.body_=n,this.transform_=e,this.motionState_=a,this.shape_=f,this.inertia_=c,this.info_=t}setRestitution(n){var e;(e=this.body_)==null||e.setRestitution(n)}setFriction(n){var e;(e=this.body_)==null||e.setFriction(n)}setRollingFriction(n){var e;(e=this.body_)==null||e.setRollingFriction(n)}}class pt extends ht{constructor(n,e,a){const f=new s.btTransform;f.setIdentity(),f.setOrigin(new s.btVector3(e.x,e.y,e.z)),f.setRotation(new s.btQuaternion(0,0,0,1));const c=new s.btDefaultMotionState(f),t=new s.btSphereShape(a);t.setMargin(.05);const b=new s.btVector3(0,0,0);n>0&&t.calculateLocalInertia(n,b);const p=new s.btRigidBodyConstructionInfo(n,c,t,b),w=new s.btRigidBody(p);super(w,f,c,t,b,p)}}async function mt(){if(!("Ammo"in window)){console.error("AmmoPhysics: Couldn't find Ammo.js");return}s=await Ammo();const d=60,n=new s.btDefaultCollisionConfiguration,e=new s.btCollisionDispatcher(n),a=new s.btDbvtBroadphase,f=new s.btSequentialImpulseConstraintSolver,c=new s.btDiscreteDynamicsWorld(e,a,f,n);c.setGravity(new s.btVector3(0,-9.8,0));const t=new s.btTransform;function b(i){const o=i.parameters;if(i.type==="BoxGeometry"){const m=o.width!==void 0?o.width/2:.5,g=o.height!==void 0?o.height/2:.5,h=o.depth!==void 0?o.depth/2:.5,S=new s.btBoxShape(new s.btVector3(m,g,h));return S.setMargin(.05),S}else if(i.type==="SphereGeometry"||i.type==="IcosahedronGeometry"){const m=o.radius!==void 0?o.radius:1,g=new s.btSphereShape(m);return g.setMargin(.05),g}return null}const p=[],w=new WeakMap;function l(i,o,m=0){o!==null&&(i.isInstancedMesh?_(i,m,o):i.isMesh&&M(i,m,o))}function u(i,o,m=0){l(i,o.shape_,m)}function y(i,o=0){const m=b(i.geometry);l(i,m,o)}function M(i,o,m){const g=i.position,h=i.quaternion,S=new s.btTransform;S.setIdentity(),S.setOrigin(new s.btVector3(g.x,g.y,g.z)),S.setRotation(new s.btQuaternion(h.x,h.y,h.z,h.w));const A=new s.btDefaultMotionState(S),x=new s.btVector3(0,0,0);m.calculateLocalInertia(o,x);const T=new s.btRigidBodyConstructionInfo(o,A,m,x),B=new s.btRigidBody(T);c.addRigidBody(B),o>0&&(p.push(i),w.set(i,B))}function _(i,o,m){const g=i.instanceMatrix.array,h=[];for(let S=0;S<i.count;S++){const A=S*16,x=new s.btTransform;x.setFromOpenGLMatrix(g.slice(A,A+16));const T=new s.btDefaultMotionState(x),B=new s.btVector3(0,0,0);m.calculateLocalInertia(o,B);const E=new s.btRigidBodyConstructionInfo(o,T,m,B),W=new s.btRigidBody(E);c.addRigidBody(W),h.push(W)}o>0&&(p.push(i),w.set(i,h))}function R(i,o,m=0){if(i.isInstancedMesh){const h=w.get(i)[m];h.setAngularVelocity(new s.btVector3(0,0,0)),h.setLinearVelocity(new s.btVector3(0,0,0)),t.setIdentity(),t.setOrigin(new s.btVector3(o.x,o.y,o.z)),h.setWorldTransform(t)}else if(i.isMesh){const g=w.get(i);g.setAngularVelocity(new s.btVector3(0,0,0)),g.setLinearVelocity(new s.btVector3(0,0,0)),t.setIdentity(),t.setOrigin(new s.btVector3(o.x,o.y,o.z)),g.setWorldTransform(t)}}let r=0;function z(){const i=performance.now();if(r>0){const o=(i-r)/1e3;c.stepSimulation(o,10);for(let m=0,g=p.length;m<g;m++){const h=p[m];if(h.isInstancedMesh){const S=h.instanceMatrix.array,A=w.get(h);for(let x=0;x<A.length;x++){A[x].getMotionState().getWorldTransform(t);const E=t.getOrigin(),W=t.getRotation();bt(E,W,S,x*16)}h.instanceMatrix.needsUpdate=!0,h.computeBoundingSphere()}else if(h.isMesh){w.get(h).getMotionState().getWorldTransform(t);const x=t.getOrigin(),T=t.getRotation();h.position.set(x.x(),x.y(),x.z()),h.quaternion.set(T.x(),T.y(),T.z(),T.w())}}}r=i}return setInterval(z,1e3/d),{addMesh:y,addMeshAndBody:u,setMeshPosition:R}}function bt(d,n,e,a){const f=n.x(),c=n.y(),t=n.z(),b=n.w(),p=f+f,w=c+c,l=t+t,u=f*p,y=f*w,M=f*l,_=c*w,R=c*l,r=t*l,z=b*p,i=b*w,o=b*l;e[a+0]=1-(_+r),e[a+1]=y+o,e[a+2]=M-i,e[a+3]=0,e[a+4]=y-o,e[a+5]=1-(u+r),e[a+6]=R+z,e[a+7]=0,e[a+8]=M+i,e[a+9]=R-z,e[a+10]=1-(u+_),e[a+11]=0,e[a+12]=d.x(),e[a+13]=d.y(),e[a+14]=d.z(),e[a+15]=1}new X;let H=new $,v=new U,D=new j,G=new wt,P,I;new Q;const yt=q({data(){return{pointer:new Y(-100,-100),inTransition:!1,transitionIteration:0,transitionLength:100,stopAnimate:!1}},setup(){return{canvasRef:rt(null)}},props:{backgroundColor:String},methods:{onWindowResize(){let d=this.$refs.canvasRef.parentElement;d&&(H.aspect=d.clientWidth/d.clientHeight,D.setSize(d.clientWidth,d.clientHeight),H.updateProjectionMatrix())},animate(d){this.stopAnimate||(requestAnimationFrame(this.animate),this.render(d),G==null||G.update())},render(d){D.render(v,H)}},async mounted(){P=await mt();const d=this.$refs.canvasRef,n=d.parentElement,e=n?n.clientWidth:window.innerWidth,a=n?n.clientHeight:window.innerHeight;D=new j({antialias:!0,canvas:d}),D.setPixelRatio(window.devicePixelRatio),D.setSize(e,a),D.shadowMap.enabled=!0,H=new $(70,e/a,.1,1e3),H.position.set(2,1.5,2),H.lookAt(0,0,0);const f=new J;v.add(f);const c=new K(16777215,3);c.position.set(5,5,5),c.castShadow=!0,c.shadow.camera.zoom=2,v.add(c),v.background=new O(6710886);const t=new V(new C(10,5,10),new Z({color:4473924}));t.position.y=-2.5,t.receiveShadow=!0,v.add(t),P.addMesh(t);const b=new V(new C(10,5,10),new F({color:6710886}));b.position.y=-2.5,v.add(b);const p=new F({color:16711680});p.opacity=0,p.transparent=!0;let w=new V(new C(1,15,4),p);w.position.y=0,w.position.z=0,w.position.x=2.5,v.add(w),P.addMesh(w);let l=new V(new C(4,15,1),p);l.position.y=0,l.position.z=-2.5,l.position.x=0,v.add(l),P.addMesh(l);let u=new V(new C(4,15,1),p);u.position.y=0,u.position.z=2.5,u.position.x=0,v.add(u),P.addMesh(u);let y=new V(new C(1,15,4),p);y.position.y=0,y.position.z=0,y.position.x=-2.5,v.add(y),P.addMesh(y),new tt;const M=new et,_=new O;new nt().load("/models/suzanne_buffergeometry.json",r=>{debugger;r.computeVertexNormals(),r.scale(.07,.07,.07);const z=new ot;I=new it(r,z,1400),I.instanceMatrix.setUsage(st),v.add(I),I.castShadow=!0,I.receiveShadow=!0;for(let o=0;o<I.count;o++)M.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),I.setMatrixAt(o,M),I.setColorAt(o,_.setHex(16777215*Math.random()));const i=new pt(1,I.position,.075);P.addMeshAndBody(I,i,1)}),window.addEventListener("resize",this.onWindowResize),this.onWindowResize(),this.animate(0)},unmounted(){this.stopAnimate=!0,at(v)}}),gt={class:"flex-grow-1 p-0 m-0 mw-100 mh-100 overflow-auto"},Mt={ref:"canvasRef"};function St(d,n,e,a,f,c){return N(),lt("div",gt,[dt("canvas",Mt,null,512)])}const xt=ct(yt,[["render",St]]),It=q({__name:"FlowerTrackerView",setup(d){const n=ut();return(e,a)=>(N(),ft(xt,{"lines-count":k(n).numOfLines,"points-count":k(n).numOfPoints,"background-color":k(n).backgroundColor,"line-color":k(n).lineColor},null,8,["lines-count","points-count","background-color","line-color"]))}});export{It as default};
